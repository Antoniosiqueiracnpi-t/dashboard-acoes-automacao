name: Atualizar Dados CVM

on:
  workflow_dispatch:  # Executar manualmente
  schedule:
    # Toda segunda-feira √†s 6h da manh√£ (UTC)
    # Para testar, voc√™ pode mudar para rodar diariamente: '0 6 * * *'
    - cron: '0 6 * * 1'

jobs:
  update-data:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout c√≥digo
      uses: actions/checkout@v3
    
    - name: Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Instalar depend√™ncias
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Verificar e atualizar dados CVM
      env:
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
      run: |
        echo "Iniciando atualiza√ß√£o autom√°tica..."
        python scripts/update_from_cvm.py
    
    - name: Notificar sucesso
      if: success()
      run: |
        echo "‚úÖ Atualiza√ß√£o conclu√≠da com sucesso!"
        echo "üìä Dados da CVM atualizados"
        echo "üïê Pr√≥xima execu√ß√£o: segunda-feira √†s 6h UTC"
    
    - name: Notificar falha
      if: failure()
      run: |
        echo "‚ùå Atualiza√ß√£o falhou"
        echo "‚ö†Ô∏è  Verifique os logs acima para detalhes"
